<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tournament Scoreboard with Multi-Match Storage</title>
  <style>
    /* Your existing styles unchanged */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .scoreboard {
      max-width: 900px;
      margin: auto;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
      padding-bottom: 20px;
    }
    .header {
      padding: 20px;
      text-align: center;
      background: #0052cc;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .match-info {
      display: flex;
      justify-content: space-between;
      padding: 15px 20px;
      font-size: 1.25rem;
      border-bottom: 1px solid #eee;
    }
    .team {
      flex: 1;
      text-align: center;
      font-weight: 600;
    }
    .score {
      font-size: 2.5rem;
      font-weight: 700;
      flex: 0.5;
      text-align: center;
      color: #0052cc;
    }
    .score-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
    }
    button {
      background: #0052cc;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #003d99;
    }
    .delete-btn {
      background: #cc0000;
      padding: 4px 8px;
      font-size: 0.9rem;
      border-radius: 4px;
      margin-left: 10px;
      cursor: pointer;
    }
    .delete-btn:hover { background: #990000; }
    .reset-btn { background: #777; }
    .reset-btn:hover { background: #555; }
    .stats-container {
      display: flex;
      justify-content: space-between;
      padding: 15px 20px;
      gap: 20px;
      flex-wrap: wrap;
    }
    .stats-section {
      flex: 1 1 45%;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 15px;
      background: #fafafa;
    }
    .team-stats-column h4 {
      margin: 0 0 8px;
      color: #0052cc;
      text-align: center;
      font-weight: 600;
      border-bottom: 1px solid #0052cc;
      padding-bottom: 4px;
    }
    .stats-list {
      list-style: none;
      padding: 0 8px;
      margin: 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
    }
    .stats-list li {
      padding: 6px 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .stats-list li:last-child { border-bottom: none; }
    form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      padding: 0 20px;
      margin-top: 20px;
    }
    label {
      flex: 1 1 100%;
      font-weight: 600;
      margin-top: 10px;
    }
    select, input[type="text"] {
      flex: 1 1 48%;
      padding: 8px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .team-name-edit {
      display: flex;
      justify-content: space-around;
      padding: 10px 20px;
      gap: 10px;
      border-bottom: 1px solid #eee;
      background: #f9f9f9;
    }
    .team-name-edit input {
      flex: 1;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .match-select-container {
      padding: 10px 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      background: #e9f0ff;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .match-select-container select {
      flex-grow: 1;
      padding: 6px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .match-select-container button {
      background: #0073e6;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .match-select-container button:hover {
      background: #005bb5;
    }
    @media (max-width: 960px) {
      .stats-container { flex-direction: column; }
      .stats-section { flex: 1 1 100%; }
      form { flex-direction: column; }
      select, input[type="text"], button { flex: 1 1 100%; }
      .team-name-edit { flex-direction: column; }
      .match-select-container { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>
  <div class="scoreboard">
    <div class="header">Tournament Match Scoreboard</div>

    <!-- Match Selector -->
    <div class="match-select-container">
      <select id="matchSelect" aria-label="Select Match"></select>
      <button id="newMatchBtn">New Match</button>
      <button id="deleteMatchBtn">Delete Match</button>
    </div>

    <!-- Editable Team Names -->
    <div class="team-name-edit">
      <input type="text" id="team1Input" placeholder="Team A Name" oninput="updateTeamName('team1')" />
      <input type="text" id="team2Input" placeholder="Team B Name" oninput="updateTeamName('team2')" />
    </div>

    <div class="match-info">
      <div class="team" id="team1Name">Team A</div>
      <div class="score" id="team1Score">0</div>
      <div class="score" id="team2Score">0</div>
      <div class="team" id="team2Name">Team B</div>
    </div>

    <div class="score-buttons">
      <button onclick="incrementScore('team1')">+ Goal Team A</button>
      <button onclick="incrementScore('team2')">+ Goal Team B</button>
      <button class="reset-btn" onclick="resetMatch()">Reset Match</button>
    </div>

    <div class="stats-container">
      <div class="stats-section">
        <h4 id="teamAStatsTitle">Team A Goals</h4>
        <ul class="stats-list" id="teamAStats"></ul>
      </div>
      <div class="stats-section">
        <h4 id="teamBStatsTitle">Team B Goals</h4>
        <ul class="stats-list" id="teamBStats"></ul>
      </div>
    </div>

    <form id="goalForm" onsubmit="addGoal(event)">
      <label>Add Goal</label>
      <select id="teamSelect" required>
        <option value="">Select Team</option>
        <option value="team1">Team A</option>
        <option value="team2">Team B</option>
      </select>
      <input type="text" id="scorerInput" placeholder="Goal Scorer" required />
      <input type="text" id="assistInput" placeholder="Assist (optional)" />
      <button type="submit">Add Goal</button>
    </form>
  </div>

<script type="module">
  // ✅ Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // ✅ Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ✅ Global state
  let scores = { team1: 0, team2: 0 };
  let goalStats = [];
  let teamNames = { team1: "Team 1", team2: "Team 2" };
  let matches = [];
  let currentMatchId = null;

  // ✅ Save data to Firestore
  async function saveData() {
    if (!currentMatchId) return;
    try {
      console.log("Saving to Firestore:", { scores, goalStats, teamNames }); // debug log
      await setDoc(doc(db, "matches", currentMatchId), {
        scores: { ...scores },            // ensure plain object
        goalStats: [...goalStats],        // ensure array is copied properly
        teamNames: { ...teamNames },
        created: matches.find(m => m.id === currentMatchId)?.created || new Date().toISOString()
      });
    } catch (e) {
      console.error("Error saving match data:", e);
      alert("Failed to save match data.");
    }
  }

  // ✅ Load matches
  async function loadMatches() {
    const querySnapshot = await getDocs(collection(db, "matches"));
    matches = [];
    querySnapshot.forEach(docSnap => {
      matches.push({ id: docSnap.id, ...docSnap.data() });
    });
    renderMatchesList();
  }

  // ✅ Load a single match
  async function loadMatch(matchId) {
    const docRef = doc(db, "matches", matchId);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      scores = data.scores || { team1: 0, team2: 0 };
      goalStats = data.goalStats || [];
      teamNames = data.teamNames || { team1: "Team 1", team2: "Team 2" };
      currentMatchId = matchId;
      render();
    }
  }

  // ✅ Add Goal (fixed)
  async function addGoal(event) {
    event.preventDefault();
    const team = document.getElementById('teamSelect').value;
    const scorer = document.getElementById('scorerInput').value.trim();
    const assist = document.getElementById('assistInput').value.trim();

    if (!team || !scorer) {
      alert("Please fill scorer and team.");
      return;
    }

    scores[team]++;
    const goalEntry = { team, scorer };
    if (assist) goalEntry.assist = assist;  // only add assist if provided
    goalStats.push(goalEntry);

    await saveData();
    render();
    event.target.reset();
  }

  // ✅ Create Match
  async function createMatch() {
    const matchId = `match_${Date.now()}`;
    currentMatchId = matchId;
    scores = { team1: 0, team2: 0 };
    goalStats = [];
    teamNames = { team1: "Team 1", team2: "Team 2" };
    await saveData();
    await loadMatches();
    render();
  }

  // ✅ Render Matches in <select>
  function renderMatchesList() {
    const selectEl = document.getElementById('matchSelect');
    selectEl.innerHTML = "";
    matches.forEach(match => {
      const option = document.createElement("option");
      option.value = match.id;
      option.textContent = `${match.teamNames?.team1 || "Team 1"} vs ${match.teamNames?.team2 || "Team 2"}`;
      if (match.id === currentMatchId) option.selected = true;
      selectEl.appendChild(option);
    });
  }

  // ✅ Delete a goal
  async function deleteGoal(index) {
    const goal = goalStats[index];
    if (goal) {
      scores[goal.team] = Math.max(0, scores[goal.team] - 1); // prevent negative scores
      goalStats.splice(index, 1);
      await saveData();
      render();
    }
  }

// ✅ Render UI
function render() {
  document.getElementById('team1Name').textContent = teamNames.team1;
  document.getElementById('team2Name').textContent = teamNames.team2;
  document.getElementById('team1Score').textContent = scores.team1;
  document.getElementById('team2Score').textContent = scores.team2;
  document.getElementById('teamAStatsTitle').textContent = `${teamNames.team1} Goals`;
  document.getElementById('teamBStatsTitle').textContent = `${teamNames.team2} Goals`;

  const teamAList = document.getElementById('teamAStats');
  const teamBList = document.getElementById('teamBStats');
  teamAList.innerHTML = "";
  teamBList.innerHTML = "";

  goalStats.forEach((g, i) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <span>${g.scorer}${g.assist ? " (Assist: " + g.assist + ")" : ""}</span>
      <button class="delete-btn" onclick="deleteGoal(${i})">❌</button>
    `;

    if (g.team === "team1") {
      teamAList.appendChild(li);
    } else {
      teamBList.appendChild(li);
    }
  });
}

  // ✅ Event Listeners
  document.getElementById('goalForm').addEventListener('submit', addGoal);
  document.getElementById('newMatchBtn').addEventListener('click', createMatch); // fixed id
  document.getElementById('matchSelect').addEventListener('change', e => loadMatch(e.target.value));

  // ✅ Init
  loadMatches();
</script>

</body>
</html>
